From 0ea45dedad90d068714bc05acba51e3687ff7e25 Mon Sep 17 00:00:00 2001
From: Your Name <Your Email>
Date: Wed, 2 Sep 2015 10:43:41 +0200
Subject: [PATCH 2/5] geam6ul-enet0-tested

---
 arch/arm/Kconfig                  |    4 ++++
 board/engicam/geam6ul/MAINTAINERS |   10 +++++-----
 board/engicam/geam6ul/geam6ul.c   |   19 +++++++++++++++----
 3 files changed, 24 insertions(+), 9 deletions(-)

diff --git a/arch/arm/Kconfig b/arch/arm/Kconfig
index 430eda1..543bd16 100644
--- a/arch/arm/Kconfig
+++ b/arch/arm/Kconfig
@@ -580,6 +580,10 @@ config TARGET_MX6UL_14X14_LPDDR2_ARM2
         bool "Support mx6ul_14x14_lpddr2_arm2"
         select CPU_V7
 
+config TARGET_GEAM6UL
+	bool "Support GEA M6UL"
+	select CPU_V7
+
 config TARGET_GW_VENTANA
 	bool "Support gw_ventana"
 	select CPU_V7
diff --git a/board/engicam/geam6ul/MAINTAINERS b/board/engicam/geam6ul/MAINTAINERS
index fe65153..ff4bbea 100644
--- a/board/engicam/geam6ul/MAINTAINERS
+++ b/board/engicam/geam6ul/MAINTAINERS
@@ -1,6 +1,6 @@
-MX6ULEVK BOARD
-M:	Fabio Estevam <fabio.estevam@freescale.com>
+GEAM6UL BOARD
+M:	Matteo Manetti <matteo.manetti@engicam.com>
 S:	Maintained
-F:	board/freescale/mx6ulevk/
-F:	include/configs/mx6ulevk.h
-F:	configs/mx6ulevk_defconfig
+F:	board/engicam/geam6ul/
+F:	include/configs/geam6ul.h
+F:	configs/geam6ul_defconfig
diff --git a/board/engicam/geam6ul/geam6ul.c b/board/engicam/geam6ul/geam6ul.c
index 07fe089..5371e0b 100644
--- a/board/engicam/geam6ul/geam6ul.c
+++ b/board/engicam/geam6ul/geam6ul.c
@@ -648,17 +648,30 @@ static int setup_fec(int fec_id)
 		= (struct iomuxc_gpr_base_regs *) IOMUXC_GPR_BASE_ADDR;
 	int ret;
 
+	if (0 == fec_id) {
 		/* Use 50M anatop loopback REF_CLK1 for ENET1, clear gpr1[13], set gpr1[17]*/
 		clrsetbits_le32(&iomuxc_gpr_regs->gpr[1], IOMUX_GPR1_FEC1_MASK,
 				IOMUX_GPR1_FEC1_CLOCK_MUX1_SEL_MASK);
-		/* Use 50M anatop loopback REF_CLK1 for ENET2, clear gpr1[14], clear gpr1[18]*/
+	} else {
+		/* Use 50M anatop loopback REF_CLK2 for ENET2, clear gpr1[14], set gpr1[18]*/
 		clrsetbits_le32(&iomuxc_gpr_regs->gpr[1], IOMUX_GPR1_FEC2_MASK,
 				0);
 
+		/* ENET0 clock is needed for ENET1 also */
+		/* Use 50M anatop loopback REF_CLK1 for ENET1, clear gpr1[13], set gpr1[17]*/
+		clrsetbits_le32(&iomuxc_gpr_regs->gpr[1], IOMUX_GPR1_FEC1_MASK,
+				IOMUX_GPR1_FEC1_CLOCK_MUX1_SEL_MASK);
+
+		ret = enable_fec_anatop_clock(0, ENET_50MHZ);
+
+	}
+
 	ret = enable_fec_anatop_clock(fec_id, ENET_50MHZ);
 	if (ret)
+	{
+		printf("enable_fec_anatop_clock error %d\n", ret);
 		return ret;
-
+	}
 	enable_enet_clk(1);
 
 	return 0;
@@ -667,8 +680,6 @@ static int setup_fec(int fec_id)
 int board_phy_config(struct phy_device *phydev)
 {
 
-	phy_write(phydev, MDIO_DEVAD_NONE, 0x1f, 0x8190);
-
 	if (phydev->drv->config)
 		phydev->drv->config(phydev);
 
-- 
1.7.9.5

