From 21415b0b2e28fba488159d1f6799b4a1cd929066 Mon Sep 17 00:00:00 2001
From: Your Name <Your Email>
Date: Wed, 2 Sep 2015 10:48:27 +0200
Subject: [PATCH 5/5] geam6ul_added_config_for_nand_and_sd

---
 board/engicam/geam6ul/imximage.cfg |    6 ++----
 configs/geam6ul_defconfig          |    2 +-
 configs/geam6ul_defconfig_sd       |    5 +++++
 configs/geam6ul_sd_defconfig       |    6 ++++++
 include/configs/geam6ul.h          |   20 ++++++++++----------
 5 files changed, 24 insertions(+), 15 deletions(-)
 create mode 100644 configs/geam6ul_defconfig_sd
 create mode 100644 configs/geam6ul_sd_defconfig

diff --git a/board/engicam/geam6ul/imximage.cfg b/board/engicam/geam6ul/imximage.cfg
index 15968b2..a86f187 100644
--- a/board/engicam/geam6ul/imximage.cfg
+++ b/board/engicam/geam6ul/imximage.cfg
@@ -22,10 +22,8 @@ IMAGE_VERSION 2
  * spi/sd/nand/onenand, qspi/nor
  */
 
-#ifdef CONFIG_SYS_BOOT_QSPI
-BOOT_FROM	qspi
-#elif defined(CONFIG_SYS_BOOT_EIMNOR)
-BOOT_FROM	nor
+#ifdef CONFIG_SYS_BOOT_NAND
+BOOT_FROM	nand
 #else
 BOOT_FROM	sd
 #endif
diff --git a/configs/geam6ul_defconfig b/configs/geam6ul_defconfig
index 58a5124..e19d3a9 100644
--- a/configs/geam6ul_defconfig
+++ b/configs/geam6ul_defconfig
@@ -1,4 +1,4 @@
-CONFIG_SYS_EXTRA_OPTIONS="IMX_CONFIG=board/engicam/geam6ul/imximage.cfg,MX6UL"
+CONFIG_SYS_EXTRA_OPTIONS="IMX_CONFIG=board/engicam/geam6ul/imximage.cfg,MX6UL,SYS_BOOT_NAND"
 CONFIG_ARM=y
 CONFIG_TARGET_GEAM6UL=y
 CONFIG_DM=y
diff --git a/configs/geam6ul_defconfig_sd b/configs/geam6ul_defconfig_sd
new file mode 100644
index 0000000..c6544cd
--- /dev/null
+++ b/configs/geam6ul_defconfig_sd
@@ -0,0 +1,5 @@
+CONFIG_SYS_EXTRA_OPTIONS="IMX_CONFIG=board/engicam/geam6ul/imximage.cfg,MX6UL"
+CONFIG_ARM=y
+CONFIG_TARGET_GEAM6UL=y
+CONFIG_DM=y
+CONFIG_DM_THERMAL=y
diff --git a/configs/geam6ul_sd_defconfig b/configs/geam6ul_sd_defconfig
new file mode 100644
index 0000000..58a5124
--- /dev/null
+++ b/configs/geam6ul_sd_defconfig
@@ -0,0 +1,6 @@
+CONFIG_SYS_EXTRA_OPTIONS="IMX_CONFIG=board/engicam/geam6ul/imximage.cfg,MX6UL"
+CONFIG_ARM=y
+CONFIG_TARGET_GEAM6UL=y
+CONFIG_DM=y
+CONFIG_DM_THERMAL=y
+CONFIG_SYS_BOOT_NAND=y
diff --git a/include/configs/geam6ul.h b/include/configs/geam6ul.h
index 948cc45..3e2db53 100644
--- a/include/configs/geam6ul.h
+++ b/include/configs/geam6ul.h
@@ -164,24 +164,26 @@
 	"console=ttymxc0\0" \
 	"bootargs=console=ttymxc0,115200 ubi.mtd=3 "  \
 		"root=ubi0:rootfs rootfstype=ubifs "		     \
-		"mtdparts=gpmi-nand:64m(boot),16m(kernel),16m(dtb),-(rootfs)\0"\
-	"bootcmd=nand read ${loadaddr} 0x4000000 0x800000;"\
-		"nand read ${fdt_addr} 0x5000000 0x100000;"\
-		"bootz ${loadaddr} - ${fdt_addr}\0"
+		"mtdparts=gpmi-nand:4m(boot),8m(kernel),1m(dtb),-(rootfs) cma=16MB\0"\
+	"bootcmd=nand read ${loadaddr} 0x400000 0x700000;"\
+		"nand read ${fdt_addr} 0xc00000 0x100000;"\
+		"bootm ${loadaddr} - ${fdt_addr}\0"
 
 #else
 #define CONFIG_EXTRA_ENV_SETTINGS \
 	CONFIG_MFG_ENV_SETTINGS \
 	CONFIG_VIDEO_MODE \
 	"script=boot.scr\0" \
-	"image=zImage\0" \
+	"image=uImage\0" \
 	"console=ttymxc0\0" \
 	"fdt_high=0xffffffff\0" \
 	"initrd_high=0xffffffff\0" \
-	"fdt_file=imx6ul-evk.dtb\0" \
+	"fdt_file=imx6ul-gea.dtb\0" \
 	"fdt_addr=0x83000000\0" \
 	"boot_fdt=try\0" \
 	"ip_dyn=yes\0" \
+ "bootcmd=fatload mmc ${mmcdev}:${mmcpart} ${loadaddr} ${image}; fatload mmc ${mmcdev}:${mmcpart} ${fdt_addr} ${fdt_file}; bootm ${loadaddr} - ${fdt_addr}\0" \
+        "bootargs=console=ttymxc0,115200  root=/dev/mmcblk0p2 rootwait rw mtdparts=gpmi-nand:4m(boot),8m(kernel),1m(dtb),-(rootfs) cma=16MB\0" \
 	"mmcdev="__stringify(CONFIG_SYS_MMC_ENV_DEV)"\0" \
 	"mmcpart=" __stringify(CONFIG_SYS_MMC_IMG_LOAD_PART) "\0" \
 	"mmcroot=" CONFIG_MMCROOT " rootwait rw\0" \
@@ -308,9 +310,7 @@
 #define CONFIG_NAND_MXS
 #define CONFIG_SYS_MAX_NAND_DEVICE	1
 #define CONFIG_SYS_NAND_BASE		0x40000000
-/*
 #define CONFIG_SYS_NAND_5_ADDR_CYCLE
-*/
 #define CONFIG_SYS_NAND_ONFI_DETECTION
 
 /* DMA stuff, needed for GPMI/MXS NAND support */
@@ -344,8 +344,8 @@
 #define CONFIG_ENV_SPI_MAX_HZ		CONFIG_SF_DEFAULT_SPEED
 #elif defined(CONFIG_ENV_IS_IN_NAND)
 #undef CONFIG_ENV_SIZE
-#define CONFIG_ENV_OFFSET		(8 << 20)
-#define CONFIG_ENV_SECT_SIZE		(128 << 10)
+#define CONFIG_ENV_OFFSET		(0x1c0000)
+#define CONFIG_ENV_SECT_SIZE		(0x20000)
 #define CONFIG_ENV_SIZE			CONFIG_ENV_SECT_SIZE
 #endif
 
-- 
1.7.9.5

